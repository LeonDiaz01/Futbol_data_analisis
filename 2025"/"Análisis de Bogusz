library(tidyverse)
library(moderndive)
library(forcats)

#Archivo descargado de Kaggle.
#Que nombres de columnas tiene el archivo

colnames(`2024.MLS.Player.Stats.Database`)

#Seleccionando las columnas que me interesan

mls_stats_2024 <- `2024.MLS.Player.Stats.Database` |>
  select(name, country, position, club, age, matches_played,
         minutes_played, goals, assists, goals_and_assists)

#Jugadores por posición

mls_stats_2024 |>
  group_by(position) |>
  summarize(total_players = n())

#No me interesan los porteros, por lo tanto voy a eliminar esa posición

mls_stats_2024 <- mls_stats_2024 |>
  filter(!position == "Keeper")

#Delantero menor de 25 años

#Filtro la tabla a partir de esas características

mls_stats_2024_forward <- mls_stats_2024 |>
  filter(position == "Forward" & 
        age < 25)

#Agrego una columna donde podamos ver los goles generados (asist y goals) por partido

mls_stats_2024_forward <- mls_stats_2024_forward |>
  mutate(goles_por_partido = goals_and_assists/matches_played)

View(mls_stats_2024_forward)
glimpse(mls_stats_2024_forward)

#Graficando el top 10 de jugadores en goles por partido

mls_stats_2024_forward |>
  head(10) |>
  mutate(name = as_factor(name),
         goals_and_assists = as_factor(goals_and_assists))|>
  arrange(desc(goles_por_partido)) |>
  ggplot() +
  geom_col(aes(x = name, y = goles_por_partido),
           fill = "seagreen") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Nombre del jugador",
       y = "Cociente de goles creados por partido (g + a)",
       title = "Top 10 de mejores generadores de goles por partido",
       subtitle = "Delanteros menores de 25 años (Temporada 2024)")

#Graficando el top 10 de jugadores en goles + asis por partido

mls_stats_2024_forward_ga <- mls_stats_2024_forward |>
  head(10) |>
  arrange(desc(goals_and_assists))


mls_stats_2024_forward_ga |>
  mutate(name = as_factor(name),
         goals_and_assists = as_factor(goals_and_assists))|>
  ggplot(aes(name, goals_and_assists, fill = name)) +
  geom_col(aes(name, goals_and_assists),
           fill = "lightblue") +
  theme_minimal()  +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Jugador",
       y = "Goles + asistencias",
       title = "Goles + asistencias por delantero",
       subtitle = "Jugadores menores de 25 años (Temporada 2024 MLS)")
